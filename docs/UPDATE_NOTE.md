# 更新日志 (Update Notes)

## Xilore Uptime Monitor

## 版本 2.0.0（当前版本）- 2026-01-26

### 主要变更
- **服务端迁移至 TypeScript**：`server.ts`、`database.ts`，类型定义 `db-types.ts`
- **构建流程**：开发使用 `ts-node` 直接运行（`npm run dev`），生产需先 `npm run build` 再 `npm start`，产物输出到 `dist/`
- **新增 404 页面**：`public/404.html` 及配套资源，未匹配路由友好提示
- **入口与依赖**：`package.json` 入口改为 `dist/server/server.js`，新增 TypeScript 相关 devDependencies
- **文档**：项目结构、技术栈、启动说明与 README 同步更新

### 升级说明（1.x → 2.0）
- 生产部署需先执行 `npm run build`，再使用 `npm start` 或 `node dist/server/server.js` 启动
- Docker 镜像已按新构建流程制作，使用 `bgluminous/xilore-uptime:latest` 无需变更

## 版本 1.6.1 - 2026-01-26

- 优化统计接口：合并查询、增加暂停数量统计，公开统计排除暂停服务
- 清空历史记录改用 TRUNCATE，支持释放表空间并同步修正前端提示
- 设置接口补齐 Webhook 配置保存（URL / Method / Headers），并支持一键清空邮件/Webhook 配置
- 管理页新增「暂停」统计卡片，状态页平均可用率不再统计暂停服务
- 监控目标地址支持点击打开，整体样式优化（去灰字/占位符颜色/状态卡片布局）
- 文档：更新版本号与资源文件结构说明

## 版本 1.6.0 - 2026-01-26

- 修复 statusbars 数据查询与渲染问题（MySQL `IN` 参数绑定与前端 ID 类型映射）
- statusbars 刷新改为局部更新（避免状态条"闪一下"）
- 邮件 HTML 模板抽离到 server/templates/，服务端渲染填充变量
- 页面标题改为由服务端路由注入（公开页/管理页无需前端动态请求）
- 精简设置/监控等接口返回字段，敏感密码改为 *_set 布尔值表示是否已设置
- 优化API接口，公共监控接口不再暴露敏感信息
- 修复分组ID更新逻辑，避免未提供时的误更新
- 优化展示页/管理页性能：monitors 基础数据与 statusbar 数据拆分为独立接口
- statusbar 聚合与填充逻辑下沉到后端（前端仅负责渲染 segments）
- 服务端代码迁移到 server/ 目录，数据库初始化/更新逻辑抽离到 server/database.js
- 添加日志表大小显示功能到危险操作区域

## 版本 1.5.0 - 2026-01-26

- 实现监控暂停/恢复功能，添加toggleMonitor方法
- 更新checkNow方法以区分刷新按钮
- 优化API接口，公共监控接口不再暴露敏感信息
- 修复分组ID更新逻辑，避免未提供时的误更新
- 优化展示页/管理页性能：monitors 基础数据与 statusbar 数据拆分为独立接口，优先渲染首屏
- statusbar 聚合与填充逻辑下沉到后端（前端仅负责渲染 segments）
- 修复暂停中的服务在修改设置后被自动触发检测的问题
- 服务端代码迁移到 `server/` 目录，数据库初始化/更新逻辑抽离到 `server/database.js`
- 管理页设置 → 危险操作中展示日志表（check_history）总大小与记录数

## 版本 1.4.0 - 2026-01-23

- 实现页面标题动态加载，支持自定义标题显示
- 添加Webhook配置测试功能，支持实时验证配置有效性
- 优化设置保存后自动刷新页面以应用新配置
- 改进历史记录删除后的页面刷新机制
- 修复监控弹窗点击外部区域关闭的逻辑

## 版本 1.3.2 - 2026-01-23

- 移除了 console.log 调试信息
- 优化了 monitor-list 容器不存在时的错误处理逻辑
- 在服务器端添加了 URL 解析失败的日志记录
- 修复了相对路径重定向的处理逻辑
- 添加了检测参数的调试日志输出

## 版本 1.3.1 - 2026-01-23

- 更新设置页面和状态页面的图标引用路径
- 在状态页面中移除监控项的类型和目标地址显示

## 版本 1.3.0 - 2026-01-23

- 实现邮件和 Webhook 通知功能，支持状态变化时发送通知
- 重构设置模态框为多标签页界面，包含基础设置、管理员账户、邮件配置、Webhook配置等
- 添加 SMTP 邮件配置和测试功能，支持管理员邮箱设置和密码修改
- 实现 Webhook 配置功能，支持自定义 URL、请求方法和请求头
- 优化时间轴渲染算法，使用状态优先级映射和前后填充逻辑
- 添加表单验证和错误处理机制，提升用户体验
- 引入 nodemailer 库支持邮件发送功能
- 更新版本号至 1.3.0

## 版本 1.2.2 - 2026-01-23

- 添加完整的版本历史记录和功能变更说明
- 更新.gitlab-ci.yml配置添加retry机制
- 修复README.md中的文档链接路径
- 统一版本发布信息和变更记录格式

## 版本 1.2.1 - 2026-01-23

- 移除前端数据采样逻辑，改为后端按时间范围自动聚合数据
- 重构图表数据显示逻辑，支持多维度响应时间展示
- 更新详情页面数据获取接口，移除不必要的limit参数
- 统一时间格式显示，增强用户体验一致性
- 添加聚合数据统计功能，包括最小最大响应时间和检测次数

---

## 版本 1.2.0 - 2026-01-23

- 添加了安装向导功能，简化初始配置流程
- 优化了公共展示页面的用户体验
- 重构了文件结构，提升代码组织性
- 新增日志保留设置功能，支持自定义日志保留时长
- 修复了配置文件路径问题，确保配置正确加载
- 修复了安装回滚逻辑，提升安装过程的稳定性

### 其他更新
- 更新了 `server.js` 核心服务文件
- 更新了 `Dockerfile` 构建配置
- 更新了 `.gitlab-ci.yml` CI/CD 配置文件
- 合并了 `release-1.0.1` 分支到 `master`

---

## 版本 1.0.0 - 2026-01-23

### 初始发布 🎉
- **项目初始化**
  - 初始提交：Xilore Uptime Monitor v1.0.0
  - 准备 v1.0.0 版本发布

### 配置优化
- 修复了 GitLab CI 配置文件命名格式问题
  - 重命名为标准的 `.gitlab-ci.yml` 格式
